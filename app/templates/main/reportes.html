{% extends "main/base.html" %}

{% block title %}Reportes Médicos{% endblock %}

{% block extra_css %}
<style>
    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 2rem;
    }
    
    .chart-small {
        height: 300px;
    }
    
    .report-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .stats-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #007bff;
    }
    
    .stats-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #007bff;
        margin: 0;
    }
    
    .stats-label {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
    }
    
    .chart-section {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .chart-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1rem;
        text-align: center;
        border-bottom: 2px solid #007bff;
        padding-bottom: 0.5rem;
    }
    
    .loading-spinner {
        text-align: center;
        padding: 2rem;
    }
    
    .btn-export {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        transition: all 0.3s ease;
    }
    
    .btn-export:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(40, 167, 69, 0.4);
        color: white;
    }
    
    .clinic-header {
        text-align: center;
        margin-bottom: 1rem;
    }
    
    .clinic-logo {
        color: #d4af37;
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header del Reporte -->
    <div class="report-header">
        <div class="clinic-header">
            <div class="clinic-logo">
                <i class="fas fa-hospital"></i> CLÍNICA FAMILIAR
            </div>
            <h5>-SHORORAGUA-</h5>
        </div>
        <h1 class="mb-1">REPORTES MÉDICOS ESTADÍSTICOS</h1>
        {% if clinic_name %}
        <p class="mb-0"><strong>Clínica:</strong> {{ clinic_name }}</p>
        {% endif %}
        <p class="mb-0">Sistema de Análisis y Estadísticas Clínicas</p>
        <div class="mt-3">
            <button class="btn btn-export" onclick="window.location.href='{{ url_for('main.exportar_reportes_pdf') }}'">
                <i class="fas fa-file-pdf me-2"></i>Exportar Reportes PDF
            </button>
        </div>
    </div>

    <!-- Estadísticas Generales -->
    <div class="row" id="estadisticas-cards">
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-number" id="total-pacientes">-</h3>
                <p class="stats-label">Total Pacientes</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-number" id="total-consultas">-</h3>
                <p class="stats-label">Total Consultas</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-number" id="promedio-edad">-</h3>
                <p class="stats-label">Edad Promedio</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-number" id="consultas-mes">-</h3>
                <p class="stats-label">Consultas Este Mes</p>
            </div>
        </div>
    </div>

    <!-- Gráficos de Distribución -->
    <div class="row">
        <!-- Distribución por Género -->
        <div class="col-md-6">
            <div class="chart-section">
                <h3 class="chart-title">Pacientes por Género</h3>
                <div class="chart-container chart-small">
                    <canvas id="generoChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Consultas por Mes -->
        <div class="col-md-6">
            <div class="chart-section">
                <h3 class="chart-title">Consultas por Mes (Últimos 6 meses)</h3>
                <div class="chart-container chart-small">
                    <canvas id="consultasMesChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Distribución por Edad -->
    <div class="chart-section">
        <h3 class="chart-title">Rango de Edades de Pacientes</h3>
        <div class="chart-container">
            <canvas id="edadChart"></canvas>
        </div>
    </div>

    <!-- Enfermedades Más Comunes -->
    <div class="chart-section">
        <h3 class="chart-title">Enfermedades Más Frecuentes</h3>
        <div class="chart-container">
            <canvas id="enfermedadesChart"></canvas>
        </div>
    </div>

    <!-- Problemas por Sistemas -->
    <div class="chart-section">
        <h3 class="chart-title">Problemas por Sistemas Médicos</h3>
        <div class="chart-container">
            <canvas id="sistemasChart"></canvas>
        </div>
        <div class="text-center mt-3">
            <p class="text-muted">Haga clic en las barras para ver detalles por sistema</p>
        </div>
    </div>

    <!-- Modal para Detalles de Sistema -->
    <div class="modal fade" id="sistemaDetalleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sistemaModalTitle">Detalle del Sistema</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="chart-container">
                        <canvas id="sistemaDetalleChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2">Generando reportes estadísticos...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/reportes.js') }}"></script>
{% endblock %}